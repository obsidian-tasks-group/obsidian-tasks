/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin: undefined
*/

"use strict";var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(let key of __getOwnPropNames(from))!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var main_exports={};__export(main_exports,{default:()=>ShortcutEditMode});module.exports=__toCommonJS(main_exports);var import_obsidian2=require("obsidian");var DEFAULT_SETTINGS={includeReadingMode:!1};var import_obsidian=require("obsidian"),ShorcutEditTab=class extends import_obsidian.PluginSettingTab{plugin;settings;constructor(app,plugin){super(app,plugin),this.plugin=plugin,this.settings=this.plugin.settings}display(){let{containerEl}=this;containerEl.empty();let translation={live:i18next.t("plugins.editor-status.edit-live-preview"),source:i18next.t("plugins.editor-status.edit-source"),showViewHeader:i18next.t("setting.appearance.option-show-view-header"),preview:i18next.t("setting.editor.option-default-new-tab-view-reading")};if(new import_obsidian.Setting(containerEl).setName("Include preview mode").setDesc("Include preview mode in the switch. You can change the order in the settings below").addToggle(toggle=>{toggle.setValue(this.settings.includeReadingMode).onChange(async value=>{this.settings.includeReadingMode=value,value||(this.settings.removeReadingButton=!1,this.plugin.showDefaultButton()),await this.plugin.saveSettings(),this.display(),this.plugin.app.workspace.trigger("layout-change")})}),this.settings.includeReadingMode){new import_obsidian.Setting(containerEl).setName("Remove the default switch between reading & editing").addToggle(toggle=>{toggle.setValue(this.settings.removeReadingButton??!1).onChange(async value=>{this.settings.removeReadingButton=value,await this.plugin.saveSettings(),value?this.plugin.hideDefaultButton():this.plugin.showDefaultButton()})});let orders=this.settings.order??["live","source","preview"];new import_obsidian.Setting(containerEl).setHeading().setName("Order of toggles");for(let mode of orders){let isFirst=orders[0]===mode,isLast=orders[orders.length-1]===mode;new import_obsidian.Setting(containerEl).setName(translation[mode]).addButton(button=>{button.setDisabled(isFirst).setIcon("chevron-up").setTooltip("Move up").onClick(async()=>{let index=orders.indexOf(mode);orders.splice(index,1),orders.splice(index-1,0,mode),this.settings.order=orders,await this.plugin.saveSettings(),this.display()})}).addButton(button=>{button.setDisabled(isLast).setIcon("chevron-down").setTooltip("Move down").onClick(async()=>{let index=orders.indexOf(mode);orders.splice(index,1),orders.splice(index+1,0,mode),this.settings.order=orders,await this.plugin.saveSettings(),this.display()})})}}}};var ShortcutEditMode=class extends import_obsidian2.Plugin{settings;button;toggleMode(lpState){let mode=this.getMode(lpState);if(this.settings.includeReadingMode){let next=this.getNext(mode);(next==="preview"||mode==="preview")&&this.app.commands.executeCommandById("markdown:toggle-preview"),mode==="live"&&next==="source"||mode==="source"&&next==="live"?this.app.commands.executeCommandById("editor:toggle-source"):(this.app.commands.executeCommandById("editor:toggle-source"),sleep(1).then(()=>{this.app.commands.executeCommandById("editor:toggle-source")}))}else this.app.commands.executeCommandById("editor:toggle-source")}async onload(){console.log(`[${this.manifest.name}] Loaded`),await this.loadSettings(),this.addSettingTab(new ShorcutEditTab(this.app,this));let translation={live:i18next.t("plugins.editor-status.edit-live-preview"),source:i18next.t("plugins.editor-status.edit-source"),showViewHeader:i18next.t("setting.appearance.option-show-view-header"),preview:i18next.t("setting.editor.option-default-new-tab-view-reading")};this.button={live:{icon:"pencil-ruler",tooltip:translation.live},source:{icon:"code",tooltip:translation.source},preview:{icon:"book-open",tooltip:translation.preview}};let config=this.app.vault.config,errorMessage=function(type){let text=`<span class="error">Error: \xAB <u>${type==="livePreview"?translation.live:translation.showViewHeader}</u> \xBB is disabled. Enable it in settings.</span>`;return(0,import_obsidian2.sanitizeHTMLToDom)(text)};(config.livePreview===!1||config.showViewHeader===!1)&&new import_obsidian2.Notice(errorMessage(config.livePreview===!1?"livePreview":"showViewHeader"),0),this.settings.removeReadingButton&&this.settings.includeReadingMode&&this.hideDefaultButton(),this.enableMode(),this.registerEvent(this.app.workspace.on("active-leaf-change",leaf=>{this.setOnlyIfNotExists(leaf)})),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.removeAction(),this.hideDefaultButton(),this.enableMode()})),this.addCommand({id:"switch-mode",name:"Switch mode",checkCallback:checking=>{let lpState=this.app.workspace.getActiveFileView();return lpState?(checking||this.toggleMode(lpState),!0):!1}})}hideDefaultButton(){if(this.settings.removeReadingButton&&this.settings.includeReadingMode){let button=document.querySelector(`.clickable-icon.view-action[aria-label*="${i18next.t("interface.menu.read-view")}"], .clickable-icon.view-action[aria-label*="${i18next.t("interface.menu.edit-view")}"]`);button&&button.classList.add("edit-mode-hide")}}showDefaultButton(){let button=document.querySelector(`.clickable-icon.view-action[aria-label*="${i18next.t("interface.menu.read-view")}"], .clickable-icon.view-action[aria-label*="${i18next.t("interface.menu.edit-view")}"]`);button&&button.classList.remove("edit-mode-hide")}setOnlyIfNotExists(leaf){let view=leaf?.view;if(view){let viewState=view.getState();this.settings.includeReadingMode?view.actionsEl?.querySelector(".edit-mode-button")||this.enableMode():viewState.mode==="source"&&(view.actionsEl?.querySelector(".edit-mode-button")||this.enableMode())}}onunload(){this.removeAction(),console.log(`[${this.manifest.name}] Unloaded`),this.showDefaultButton()}enableMode(){let lpState=this.app.workspace.getActiveFileView();if(lpState){if(this.settings.includeReadingMode)this.addButton(this.getMode(lpState),lpState);else if(lpState.getState().mode==="source"){let mode=lpState.getState().source===!0?"source":"live";this.addButton(mode,lpState)}}}getMode(lpState){return lpState.getState().mode==="source"?lpState.getState().source===!0?"source":"live":"preview"}getNext(actualMode){let order=this.settings.order??["live","source","preview"],next=order.indexOf(actualMode)+1;return next>=order.length&&(next=0),order[next]}removeAction(){activeDocument.querySelectorAll(".edit-mode-button").forEach(el=>{el.remove()})}addButton(mode,lpState){this.button||new Error("Button is not defined");let action=lpState.addAction(this.button[mode].icon,this.button[mode].tooltip,()=>{this.toggleMode(lpState)});action.addClass("edit-mode-button");let defaultButton=lpState.leaf.containerEl.querySelector(`.clickable-icon.view-action[aria-label*="${i18next.t("interface.menu.read-view")}"], .clickable-icon.view-action[aria-label*="${i18next.t("interface.menu.edit-view")}"]`);defaultButton&&action.after(defaultButton)}async loadSettings(){this.settings=Object.assign({},DEFAULT_SETTINGS,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */
